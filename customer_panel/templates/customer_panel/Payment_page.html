<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Complete Payment - MovieFlix</title>
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
</head>
<body style="background-color: #141414; color: white; font-family: Arial, sans-serif; text-align: center; padding-top: 100px;">

    <h2>Finalizing your {{ plan_type }} Subscription</h2>
    <p>Please do not refresh the page...</p>

    <script>
        var options = {
            // "key": "{{ razorpay_key_id }}", 
            // "amount": "{{ amount }}", 
            // "currency": "{{ currency }}",
            // "name": "MovieFlix",
            // "description": "{{ plan_type }} - {{ duration }} Month(s)",
            // "order_id": "{{ razorpay_order_id }}", 
           
            "key": "{{ razorpay_key_id }}", 
            "amount": "{{ amount }}", 
            "description": "{{ plan_type }} Subscription",
            "order_id": "{{ razorpay_order_id }}", 
            "handler": function (response){
                // On success, create a hidden form and submit to your callback view
                var form = document.createElement('form');
                form.method = 'POST';
                form.action = "{% url 'payment_callback' %}";
                
                var params = {
                    'razorpay_payment_id': response.razorpay_payment_id,
                    'razorpay_order_id': response.razorpay_order_id,
                    'razorpay_signature': response.razorpay_signature,
                    'csrfmiddlewaretoken': '{{ csrf_token }}'
                };

                for (var key in params) {
                    var input = document.createElement('input');
                    input.type = 'hidden';
                    input.name = key;
                    input.value = params[key];
                    form.appendChild(input);
                }
                document.body.appendChild(form);
                form.submit();
            },
            "prefill": {
                "name": "{{ customer_name }}",
                "email": "{{ customer_email }}",
                "contact": "{{ customer_phone }}"
            },
            "theme": { "color": "#E50914" },
            "modal": {
                "ondismiss": function(){
                    window.location.href = "{% url 'payment_failed' %}";
                }
            }
        };
        var rzp1 = new Razorpay(options);
        rzp1.open();
        
    </script>
</body>
</html>